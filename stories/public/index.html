<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Stories do Blog</title>
</head>
<body>
  <h1>Stories (expiram em 24h)</h1>

  <form id="formTexto">
    <input type="text" id="texto" placeholder="Texto do story" required>
    <button type="submit">Postar story de texto</button>
  </form>

  <br>

  <form id="formImagem" action="/api/story-img" method="POST" enctype="multipart/form-data">
    <input type="file" name="imagem" accept="image/*" required>
    <button type="submit">Enviar imagem</button>
  </form>

  <hr>
  <div id="stories"></div>

  <script>
    async function carregarStories() {
      const res = await fetch('/api/stories');
      const stories = await res.json();
      const div = document.getElementById('stories');
      div.innerHTML = '';

      if (stories.length === 0) {
        div.innerHTML = '<p>Nenhum story ativo no momento.</p>';
      } else {
        stories.reverse().forEach(story => {
          const data = new Date(story.timestamp).toLocaleString('pt-BR');
          if (story.tipo === 'texto') {
            div.innerHTML += `<p><strong>${data}</strong><br>${story.conteudo}</p><hr>`;
          } else if (story.tipo === 'imagem') {
            div.innerHTML += `<p><strong>${data}</strong><br><img src="${story.conteudo}" width="200"></p><hr>`;
          }
        });
      }
    }

    document.getElementById('formTexto').addEventListener('submit', async (e) => {
      e.preventDefault();
      const texto = document.getElementById('texto').value.trim();
      if (!texto) return;
      await fetch('/api/story', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ texto })
      });
      document.getElementById('texto').value = '';
      carregarStories();
    });

    carregarStories();
  </script>
</body>
</html>
